## 12.9 扩展 JSR-352 批处理作业

 Spring Batch 的 job 有4种扩展方式 (后两种方式支持使用多个JVM来执行):

- Split - 并行执行多个 step.
- Multiple threads - 通过多线程执行单个 step.
- Partitioning - 将数据切分后并行处理 (主从,master/slave).
- Remote Chunking - 远程执行逻辑处理块.

JSR-352 提供了两种扩展批处理的方式。这两种方式都只支持在单个 JVM 中运行:

- Split - 和 Spring Batch 一样
- Partitioning - 在概念上与Spring Batch一样,但实现略有不同。


###12.9.1 Partitioning

Conceptually, partitioning in JSR-352 is the same as it is in Spring Batch. Meta-data is provided to each slave to identify the input to be processed with the slaves reporting back to the master the results upon completion. However, there are some important differences:

- Partitioned Batchlet - This will run multiple instances of the configured Batchlet on multiple threads. Each instance will have it's own set of properties as provided by the JSL or the PartitionPlan
- PartitionPlan - With Spring Batch's partitioning, an ExecutionContext is provided for each partition. With JSR-352, a single javax.batch.api.partition.PartitionPlan is provided with an array of Properties providing the meta-data for each partition.
- PartitionMapper - JSR-352 provides two ways to generate partition meta-data. One is via the JSL (partition properties). The second is via an implementation of the javax.batch.api.partition.PartitionMapper interface. Functionally, this interface is similar to the org.springframework.batch.core.partition.support.Partitioner interface provided by Spring Batch in that it provides a way to programmaticaly generate meta-data for partitioning.
- StepExecutions - In Spring Batch, partitioned steps are run as master/slave. Within JSR-352, the same configuration occurs. However, the slave steps do not get official StepExecutions. Because of that, calls to JsrJobOperator#getStepExecutions(long jobExecutionId) will only return the StepExecution for the master.

>#### [Note]	提示 ####
> The child StepExecutions still exist in the job repository and are available via the JobExplorer and Spring Batch Admin.

- Compensating logic - Since Spring Batch implements the master/slave logic of partitioning using steps, StepExecutionListeners can be used to handle compensating logic if something goes wrong. However, since the slaves JSR-352 provides a collection of other components for the ability to provide compensating logic when errors occur and to dynamically set the exit status. These components include the following:


<table style="border-collapse: collapse;border: 0.5pt solid ;">
	<colgroup><col align="left"><col align="left"></colgroup>
	<tbody>
		<tr>
			<td><span class="bold"><strong>构件接口(Artifact Interface)</strong></span></td>
			<td><span class="bold"><strong>说明(Description)</strong></span></td>
		</tr>
		<tr>
			<td><code class="classname">javax.batch.api.partition.PartitionCollector</code></td>
			<td>
				Provides a way for slave steps to send information back to the master. 
				There is one instance per slave thread.
			</td>
		</tr>
		<tr>
			<td><code class="classname">javax.batch.api.partition.PartitionAnalyzer</code></td>
			<td>
				End point that receives the information collected by the 
				<code class="classname">PartitionCollector</code> 
				as well as the resulting statuses from a completed partition.
			</td>
		</tr>
		<tr>
			<td><code class="classname">javax.batch.api.partition.PartitionReducer</code></td>
			<td style="" >Provides the ability to provide compensating logic for a partitioned step.</td>
		</tr>
	</tbody>
</table>

